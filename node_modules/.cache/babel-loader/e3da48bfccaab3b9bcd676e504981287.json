{"remainingRequest":"/Users/frank/Desktop/project-demo/travel/node_modules/babel-loader/lib/index.js!/Users/frank/Desktop/project-demo/travel/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/frank/Desktop/project-demo/travel/node_modules/vue-cli-plugin-vue-next/node_modules/vue-loader/dist/index.js??ref--0-1!/Users/frank/Desktop/project-demo/travel/src/pages/city/components/Search.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/frank/Desktop/project-demo/travel/src/pages/city/components/Search.vue","mtime":1591724150624},{"path":"/Users/frank/Desktop/project-demo/travel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/frank/Desktop/project-demo/travel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/frank/Desktop/project-demo/travel/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/frank/Desktop/project-demo/travel/node_modules/vue-cli-plugin-vue-next/node_modules/vue-loader/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0IHsgdXNlU3RvcmUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAndnVlLXJvdXRlcic7CmltcG9ydCB7IGNvbXB1dGVkLCB3YXRjaCwgb25Nb3VudGVkLCByZWYgfSBmcm9tICd2dWUnOwppbXBvcnQgQlNjcm9sbCBmcm9tICdiZXR0ZXItc2Nyb2xsJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDaXR5U2VhcmNoJywKICBwcm9wczogewogICAgY2l0aWVzOiBPYmplY3QKICB9LAogIHNldHVwOiBmdW5jdGlvbiBzZXR1cChwcm9wcykgewogICAgdmFyIGtleXdvcmQgPSByZWYoJycpOwogICAgdmFyIGxpc3QgPSByZWYoW10pOwogICAgdmFyIHNlYXJjaCA9IHJlZihudWxsKTsKICAgIHZhciB0aW1lciA9IG51bGw7CiAgICB2YXIgc3RvcmUgPSB1c2VTdG9yZSgpOwogICAgdmFyIHJvdXRlciA9IHVzZVJvdXRlcigpOwogICAgdmFyIGhhc05vRGF0YSA9IGNvbXB1dGVkKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICFsaXN0LnZhbHVlLmxlbmd0aDsKICAgIH0pOwoKICAgIGZ1bmN0aW9uIGhhbmRsZUNpdHlDbGljayhjaXR5KSB7CiAgICAgIHN0b3JlLmNvbW1pdCgnY2hhbmdlQ2l0eScsIGNpdHkpOwogICAgICByb3V0ZXIucHVzaCgnLycpOwogICAgfQoKICAgIHdhdGNoKGtleXdvcmQsIGZ1bmN0aW9uIChrZXl3b3JkLCBwcmV2S2V5d29yZCkgewogICAgICBpZiAodGltZXIpIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgICAgIHRpbWVyID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKCFrZXl3b3JkKSB7CiAgICAgICAgbGlzdC52YWx1ZSA9IFtdOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gW107CgogICAgICAgIGZvciAodmFyIGkgaW4gcHJvcHMuY2l0aWVzKSB7CiAgICAgICAgICBwcm9wcy5jaXRpZXNbaV0uZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlLnNwZWxsLmluZGV4T2Yoa2V5d29yZC50b0xvd2VyQ2FzZSgpKSA+IC0xIHx8IHZhbHVlLm5hbWUuaW5kZXhPZihrZXl3b3JkKSA+IC0xKSB7CiAgICAgICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGxpc3QudmFsdWUgPSByZXN1bHQ7IC8vIGNvbnNvbGUubG9nKCFsaXN0LnZhbHVlLmxlbmd0aCkKICAgICAgfSwgMTAwKTsKICAgIH0pOwogICAgb25Nb3VudGVkKGZ1bmN0aW9uICgpIHsKICAgICAgbmV3IEJTY3JvbGwoc2VhcmNoLnZhbHVlLCB7CiAgICAgICAgY2xpY2s6IHRydWUKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIGtleXdvcmQ6IGtleXdvcmQsCiAgICAgIGxpc3Q6IGxpc3QsCiAgICAgIGhhc05vRGF0YTogaGFzTm9EYXRhLAogICAgICBoYW5kbGVDaXR5Q2xpY2s6IGhhbmRsZUNpdHlDbGljaywKICAgICAgc2VhcmNoOiBzZWFyY2gKICAgIH07CiAgfQp9Ow=="},{"version":3,"sources":["/Users/frank/Desktop/project-demo/travel/src/pages/city/components/Search.vue"],"names":[],"mappings":";;;;AAiBA,SAAQ,QAAR,QAAuB,MAAvB;AACA,SAAQ,SAAR,QAAwB,YAAxB;AACA,SAAQ,QAAR,EAAkB,KAAlB,EAAyB,SAAzB,EAAoC,GAApC,QAA8C,KAA9C;AACA,OAAO,OAAP,MAAoB,eAApB;AACA,eAAe;AACb,EAAA,IAAI,EAAE,YADO;AAEb,EAAA,KAAK,EAAE;AACL,IAAA,MAAM,EAAE;AADH,GAFM;AAKb,EAAA,KALa,iBAKP,KALO,EAKA;AACX,QAAM,OAAM,GAAI,GAAG,CAAC,EAAD,CAAnB;AACA,QAAM,IAAG,GAAI,GAAG,CAAC,EAAD,CAAhB;AACA,QAAM,MAAK,GAAI,GAAG,CAAC,IAAD,CAAlB;AACA,QAAI,KAAI,GAAI,IAAZ;AACA,QAAM,KAAI,GAAI,QAAQ,EAAtB;AACA,QAAM,MAAK,GAAI,SAAS,EAAxB;AACA,QAAM,SAAQ,GAAI,QAAQ,CAAC,YAAM;AAC/B,aAAO,CAAC,IAAI,CAAC,KAAL,CAAW,MAAnB;AAA0B,KADF,CAA1B;;AAGA,aAAS,eAAT,CAA0B,IAA1B,EAAgC;AAC9B,MAAA,KAAK,CAAC,MAAN,CAAa,YAAb,EAA2B,IAA3B;AACA,MAAA,MAAM,CAAC,IAAP,CAAY,GAAZ;AACF;;AAEA,IAAA,KAAK,CAAC,OAAD,EAAU,UAAC,OAAD,EAAS,WAAT,EAAyB;AACtC,UAAI,KAAJ,EAAW;AACT,QAAA,YAAY,CAAC,KAAD,CAAZ;AACA,QAAA,KAAI,GAAI,IAAR;AACF;;AACA,UAAI,CAAC,OAAL,EAAc;AACV,QAAA,IAAI,CAAC,KAAL,GAAa,EAAb;AACA;AACF;;AACF,MAAA,KAAI,GAAI,UAAU,CAAC,YAAM;AACvB,YAAM,MAAK,GAAI,EAAf;;AACA,aAAK,IAAI,CAAT,IAAc,KAAK,CAAC,MAApB,EAA4B;AAC1B,UAAA,KAAK,CAAC,MAAN,CAAa,CAAb,EAAgB,OAAhB,CAAwB,UAAC,KAAD,EAAW;AACjC,gBAAI,KAAK,CAAC,KAAN,CAAY,OAAZ,CAAoB,OAAO,CAAC,WAAR,EAApB,IAA6C,CAAC,CAA9C,IACJ,KAAK,CAAC,IAAN,CAAW,OAAX,CAAmB,OAAnB,IAA8B,CAAC,CAD/B,EACkC;AAChC,cAAA,MAAM,CAAC,IAAP,CAAY,KAAZ;AAEF;AACD,WAND;AAOF;;AACA,QAAA,IAAI,CAAC,KAAL,GAAa,MAAb,CAXuB,CAYvB;AACD,OAbiB,EAaf,GAbe,CAAlB;AAcD,KAvBI,CAAL;AAyBF,IAAA,SAAS,CAAC,YAAK;AACb,UAAI,OAAJ,CAAY,MAAM,CAAC,KAAnB,EAA0B;AAAC,QAAA,KAAK,EAAE;AAAR,OAA1B;AACD,KAFQ,CAAT;AAGA,WAAO;AAAC,MAAA,OAAO,EAAP,OAAD;AAAU,MAAA,IAAI,EAAJ,IAAV;AAAgB,MAAA,SAAS,EAAT,SAAhB;AAA2B,MAAA,eAAe,EAAf,eAA3B;AAA4C,MAAA,MAAM,EAAN;AAA5C,KAAP;AACA;AAjDa,CAAf","sourcesContent":["<template>\n  <div>\n    <div class=\"wrapper\">\n      <input class=\"input\" placeholder=\"输入城市名或拼音\" v-model=\"keyword\"/>\n    </div>\n    <div class=\"search-content\" ref=\"search\" v-show=\"keyword\">\n        <ul>\n          <li class=\"list border-bottom\" v-for=\"item of list\" :key=\"item.id\"\n          @click=\"handleCityClick(item.name)\"\n          >{{item.name}}</li>\n          <li class=\"list border-bottom\" v-show=\"hasNoData\">没有找到匹配数据</li>\n        </ul>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {useStore} from 'vuex'\nimport {useRouter} from 'vue-router'\nimport {computed, watch, onMounted, ref} from 'vue'\nimport BScroll from 'better-scroll'\nexport default {\n  name: 'CitySearch',\n  props: {\n    cities: Object\n  },\n  setup(props) {\n    const keyword = ref('')\n    const list = ref([])\n    const search = ref(null)\n    let timer = null\n    const store = useStore()\n    const router = useRouter()\n    const hasNoData = computed(() => {\n      return !list.value.length})\n\n    function handleCityClick (city) {\n      store.commit('changeCity', city)\n      router.push('/')\n    }\n\n    watch(keyword, (keyword,prevKeyword) => {\n      if (timer) {\n        clearTimeout(timer)\n        timer = null\n      }\n      if (!keyword) {\n          list.value = []       \n          return\n        }\n      timer = setTimeout(() => {\n        const result = []\n        for (let i in props.cities) {\n          props.cities[i].forEach((value) => {\n            if (value.spell.indexOf(keyword.toLowerCase()) > -1 ||\n            value.name.indexOf(keyword) > -1) {\n              result.push(value)\n              \n            }\n          })\n        }\n        list.value = result\n        // console.log(!list.value.length)\n      }, 100)\n    })\n\n  onMounted(() =>{\n    new BScroll(search.value, {click: true})\n  })\n  return {keyword, list, hasNoData, handleCityClick, search}\n  }\n}\n</script>\n\n<style scoped>\n.wrapper {\n  height: 0.58rem;\n  background: #00bcd4;\n  line-height: 0.58rem;\n  text-align: center;\n}\n.input {\n  width: 95%;\n  border-radius: 0.05rem;\n  text-align: center;\n  font-size: 0.26rem;\n  color: #ccc;\n  box-sizing: border-box;\n  padding: 0 0.1rem;\n}\n.search-content{\n  z-index: 1;\n  position: absolute;\n  top: 1.26rem;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: #ccc;\n}\n.list{\n  background: #fff;\n  color: #666;\n  line-height: .48rem;\n  padding-left: .2rem;\n}\n</style>\n"],"sourceRoot":""}]}