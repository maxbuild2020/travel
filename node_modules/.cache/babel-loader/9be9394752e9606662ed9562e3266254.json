{"remainingRequest":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/thread-loader/dist/cjs.js!/Users/frank/Documents/GitHub/travel-vue3/node_modules/babel-loader/lib/index.js!/Users/frank/Documents/GitHub/travel-vue3/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/frank/Documents/GitHub/travel-vue3/node_modules/vue-cli-plugin-vue-next/node_modules/vue-loader/dist/index.js??ref--0-1!/Users/frank/Documents/GitHub/travel-vue3/src/pages/city/components/Search.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/frank/Documents/GitHub/travel-vue3/src/pages/city/components/Search.vue","mtime":1594473395061},{"path":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/cache-loader/dist/cjs.js","mtime":1594473392680},{"path":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/thread-loader/dist/cjs.js","mtime":1594473394786},{"path":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/babel-loader/lib/index.js","mtime":1594473392373},{"path":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/cache-loader/dist/cjs.js","mtime":1594473392680},{"path":"/Users/frank/Documents/GitHub/travel-vue3/node_modules/vue-cli-plugin-vue-next/node_modules/vue-loader/dist/index.js","mtime":1594473394874}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CmltcG9ydCB7IHVzZVN0b3JlIH0gZnJvbSAndnVleCc7CmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gJ3Z1ZS1yb3V0ZXInOwppbXBvcnQgeyBjb21wdXRlZCwgd2F0Y2gsIG9uTW91bnRlZCwgcmVmIH0gZnJvbSAndnVlJzsKaW1wb3J0IEJTY3JvbGwgZnJvbSAnYmV0dGVyLXNjcm9sbCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ2l0eVNlYXJjaCcsCiAgcHJvcHM6IHsKICAgIGNpdGllczogT2JqZWN0CiAgfSwKICBzZXR1cDogZnVuY3Rpb24gc2V0dXAocHJvcHMpIHsKICAgIHZhciBrZXl3b3JkID0gcmVmKCcnKTsKICAgIHZhciBsaXN0ID0gcmVmKFtdKTsKICAgIHZhciBzZWFyY2ggPSByZWYobnVsbCk7CiAgICB2YXIgdGltZXIgPSBudWxsOwogICAgdmFyIHN0b3JlID0gdXNlU3RvcmUoKTsKICAgIHZhciByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICAgIHZhciBoYXNOb0RhdGEgPSBjb21wdXRlZChmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiAhbGlzdC52YWx1ZS5sZW5ndGg7CiAgICB9KTsKCiAgICBmdW5jdGlvbiBoYW5kbGVDaXR5Q2xpY2soY2l0eSkgewogICAgICBzdG9yZS5jb21taXQoJ2NoYW5nZUNpdHknLCBjaXR5KTsKICAgICAgcm91dGVyLnB1c2goJy8nKTsKICAgIH0KCiAgICB3YXRjaChrZXl3b3JkLCBmdW5jdGlvbiAoa2V5d29yZCwgcHJldktleXdvcmQpIHsKICAgICAgaWYgKHRpbWVyKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgICB0aW1lciA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICgha2V5d29yZCkgewogICAgICAgIGxpc3QudmFsdWUgPSBbXTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwoKICAgICAgICBmb3IgKHZhciBpIGluIHByb3BzLmNpdGllcykgewogICAgICAgICAgcHJvcHMuY2l0aWVzW2ldLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5zcGVsbC5pbmRleE9mKGtleXdvcmQudG9Mb3dlckNhc2UoKSkgPiAtMSB8fCB2YWx1ZS5uYW1lLmluZGV4T2Yoa2V5d29yZCkgPiAtMSkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBsaXN0LnZhbHVlID0gcmVzdWx0OyAvLyBjb25zb2xlLmxvZyghbGlzdC52YWx1ZS5sZW5ndGgpCiAgICAgIH0sIDEwMCk7CiAgICB9KTsKICAgIG9uTW91bnRlZChmdW5jdGlvbiAoKSB7CiAgICAgIG5ldyBCU2Nyb2xsKHNlYXJjaC52YWx1ZSwgewogICAgICAgIGNsaWNrOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gewogICAgICBrZXl3b3JkOiBrZXl3b3JkLAogICAgICBsaXN0OiBsaXN0LAogICAgICBoYXNOb0RhdGE6IGhhc05vRGF0YSwKICAgICAgaGFuZGxlQ2l0eUNsaWNrOiBoYW5kbGVDaXR5Q2xpY2ssCiAgICAgIHNlYXJjaDogc2VhcmNoCiAgICB9OwogIH0KfTs="},{"version":3,"sources":["/Users/frank/Documents/GitHub/travel-vue3/src/pages/city/components/Search.vue"],"names":[],"mappings":";;;;;AAiBA,SAAQ,QAAR,QAAuB,MAAvB;AACA,SAAQ,SAAR,QAAwB,YAAxB;AACA,SAAQ,QAAR,EAAkB,KAAlB,EAAyB,SAAzB,EAAoC,GAApC,QAA8C,KAA9C;AACA,OAAO,OAAP,MAAoB,eAApB;AACA,eAAe;AACb,EAAA,IAAI,EAAE,YADO;AAEb,EAAA,KAAK,EAAE;AACL,IAAA,MAAM,EAAE;AADH,GAFM;AAKb,EAAA,KALa,iBAKP,KALO,EAKA;AACX,QAAM,OAAM,GAAI,GAAG,CAAC,EAAD,CAAnB;AACA,QAAM,IAAG,GAAI,GAAG,CAAC,EAAD,CAAhB;AACA,QAAM,MAAK,GAAI,GAAG,CAAC,IAAD,CAAlB;AACA,QAAI,KAAI,GAAI,IAAZ;AACA,QAAM,KAAI,GAAI,QAAQ,EAAtB;AACA,QAAM,MAAK,GAAI,SAAS,EAAxB;AACA,QAAM,SAAQ,GAAI,QAAQ,CAAC,YAAM;AAC/B,aAAO,CAAC,IAAI,CAAC,KAAL,CAAW,MAAnB;AAA0B,KADF,CAA1B;;AAGA,aAAS,eAAT,CAA0B,IAA1B,EAAgC;AAC9B,MAAA,KAAK,CAAC,MAAN,CAAa,YAAb,EAA2B,IAA3B;AACA,MAAA,MAAM,CAAC,IAAP,CAAY,GAAZ;AACF;;AAEA,IAAA,KAAK,CAAC,OAAD,EAAU,UAAC,OAAD,EAAS,WAAT,EAAyB;AACtC,UAAI,KAAJ,EAAW;AACT,QAAA,YAAY,CAAC,KAAD,CAAZ;AACA,QAAA,KAAI,GAAI,IAAR;AACF;;AACA,UAAI,CAAC,OAAL,EAAc;AACV,QAAA,IAAI,CAAC,KAAL,GAAa,EAAb;AACA;AACF;;AACF,MAAA,KAAI,GAAI,UAAU,CAAC,YAAM;AACvB,YAAM,MAAK,GAAI,EAAf;;AACA,aAAK,IAAI,CAAT,IAAc,KAAK,CAAC,MAApB,EAA4B;AAC1B,UAAA,KAAK,CAAC,MAAN,CAAa,CAAb,EAAgB,OAAhB,CAAwB,UAAC,KAAD,EAAW;AACjC,gBAAI,KAAK,CAAC,KAAN,CAAY,OAAZ,CAAoB,OAAO,CAAC,WAAR,EAApB,IAA6C,CAAC,CAA9C,IACJ,KAAK,CAAC,IAAN,CAAW,OAAX,CAAmB,OAAnB,IAA8B,CAAC,CAD/B,EACkC;AAChC,cAAA,MAAM,CAAC,IAAP,CAAY,KAAZ;AAEF;AACD,WAND;AAOF;;AACA,QAAA,IAAI,CAAC,KAAL,GAAa,MAAb,CAXuB,CAYvB;AACD,OAbiB,EAaf,GAbe,CAAlB;AAcD,KAvBI,CAAL;AAyBF,IAAA,SAAS,CAAC,YAAK;AACb,UAAI,OAAJ,CAAY,MAAM,CAAC,KAAnB,EAA0B;AAAC,QAAA,KAAK,EAAE;AAAR,OAA1B;AACD,KAFQ,CAAT;AAGA,WAAO;AAAC,MAAA,OAAO,EAAP,OAAD;AAAU,MAAA,IAAI,EAAJ,IAAV;AAAgB,MAAA,SAAS,EAAT,SAAhB;AAA2B,MAAA,eAAe,EAAf,eAA3B;AAA4C,MAAA,MAAM,EAAN;AAA5C,KAAP;AACA;AAjDa,CAAf","sourcesContent":["<template>\n  <div>\n    <div class=\"wrapper\">\n      <input class=\"input\" placeholder=\"输入城市名或拼音\" v-model=\"keyword\"/>\n    </div>\n    <div class=\"search-content\" ref=\"search\" v-show=\"keyword\">\n        <ul>\n          <li class=\"list border-bottom\" v-for=\"item of list\" :key=\"item.id\"\n          @click=\"handleCityClick(item.name)\"\n          >{{item.name}}</li>\n          <li class=\"list border-bottom\" v-show=\"hasNoData\">没有找到匹配数据</li>\n        </ul>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {useStore} from 'vuex'\nimport {useRouter} from 'vue-router'\nimport {computed, watch, onMounted, ref} from 'vue'\nimport BScroll from 'better-scroll'\nexport default {\n  name: 'CitySearch',\n  props: {\n    cities: Object\n  },\n  setup(props) {\n    const keyword = ref('')\n    const list = ref([])\n    const search = ref(null)\n    let timer = null\n    const store = useStore()\n    const router = useRouter()\n    const hasNoData = computed(() => {\n      return !list.value.length})\n\n    function handleCityClick (city) {\n      store.commit('changeCity', city)\n      router.push('/')\n    }\n\n    watch(keyword, (keyword,prevKeyword) => {\n      if (timer) {\n        clearTimeout(timer)\n        timer = null\n      }\n      if (!keyword) {\n          list.value = []       \n          return\n        }\n      timer = setTimeout(() => {\n        const result = []\n        for (let i in props.cities) {\n          props.cities[i].forEach((value) => {\n            if (value.spell.indexOf(keyword.toLowerCase()) > -1 ||\n            value.name.indexOf(keyword) > -1) {\n              result.push(value)\n              \n            }\n          })\n        }\n        list.value = result\n        // console.log(!list.value.length)\n      }, 100)\n    })\n\n  onMounted(() =>{\n    new BScroll(search.value, {click: true})\n  })\n  return {keyword, list, hasNoData, handleCityClick, search}\n  }\n}\n</script>\n\n<style scoped>\n.wrapper {\n  height: 0.58rem;\n  background: #00bcd4;\n  line-height: 0.58rem;\n  text-align: center;\n}\n.input {\n  width: 95%;\n  border-radius: 0.05rem;\n  text-align: center;\n  font-size: 0.26rem;\n  color: #ccc;\n  box-sizing: border-box;\n  padding: 0 0.1rem;\n}\n.search-content{\n  z-index: 1;\n  position: absolute;\n  top: 1.26rem;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: #ccc;\n}\n.list{\n  background: #fff;\n  color: #666;\n  line-height: .48rem;\n  padding-left: .2rem;\n}\n</style>\n"],"sourceRoot":""}]}